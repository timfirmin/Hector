/*
Deployment script for FinanceStage

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "FinanceStage"
:setvar DefaultFilePrefix "FinanceStage"
:setvar DefaultDataPath "F:\SQLServerDatabases\"
:setvar DefaultLogPath "G:\SQLServerXLogs\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];




GO
CREATE SCHEMA [TM1Control]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [TM1Staging]...';


GO
CREATE SCHEMA [TM1Staging]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [TM1Transform]...';


GO
CREATE SCHEMA [TM1Transform]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [TM1Control].[ImportFileLog]...';


GO
CREATE TABLE [TM1Control].[ImportFileLog] (
    [FileLogUniqueKey]           INT           IDENTITY (1, 1) NOT NULL,
    [FileRawRowCount]            INT           NOT NULL,
    [FileCreatedTimeStamp]       VARCHAR (255) NOT NULL,
    [FileModifiedTimeStamp]      VARCHAR (255) NOT NULL,
    [FilePath]                   VARCHAR (255) NOT NULL,
    [FileName]                   VARCHAR (255) NOT NULL,
    [FileSource]                 VARCHAR (255) NOT NULL,
    [FileStartPeriodString]      AS            (replace(replace(ltrim(substring(replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), (1)) + (2), (7))), 't', ''), '_', '')),
    [FileEndPeriodString]        AS            (replace(replace(replace(ltrim(substring(replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), (1)) + (5)) + (2), (8))), 'T', ''), '_', ''), 'M', '')),
    [FileStartPeriodSeq]         AS            (CONVERT (INT, RIGHT(replace(replace(ltrim(substring(replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), (1)) + (2), (7))), 't', ''), '_', ''), (4))) * (12) + CONVERT (INT, replace(LEFT(replace(replace(ltrim(substring(replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), (1)) + (2), (7))), 't', ''), '_', ''), (2)), '-', ''))),
    [FileEndPeriodSeq]           AS            (CONVERT (INT, RIGHT(rtrim(replace(replace(replace(ltrim(substring(replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), (1)) + (5)) + (2), (8))), 'T', ''), '_', ''), 'M', '')), (4))) * (12) + CONVERT (INT, replace(LEFT(replace(replace(replace(ltrim(substring(replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), charindex('Pd', replace([FileName], ' ', ''), (1)) + (5)) + (2), (8))), 'T', ''), '_', ''), 'M', ''), (2)), '-', ''))),
    [FileTypeKey]                INT           NULL,
    [DerivedFileType]            AS            (CASE LEFT([FileName], (2)) WHEN '01' THEN 'Costs' WHEN '02' THEN 'Revenue' ELSE 'Unknown' END),
    [FileSize]                   VARCHAR (255) NULL,
    [SourceFileID]               VARCHAR (50)  NULL,
    [SourceFileInsertTimeStamp]  DATETIME2 (2) NULL,
    [StagingValidToLoadFlag]     VARCHAR (1)   NOT NULL,
    [StagingStartPeriodSeq]      INT           NULL,
    [StagingEndPeriodSeq]        INT           NULL,
    [StagingTotalRows]           INT           NULL,
    [StagingValidValue]          FLOAT (53)    NULL,
    [StagingValidStatus]         AS            (CASE WHEN [StagingTotalRows] > (0)
                                                          AND [StagingTotalRows] = [FileRawRowCount] THEN 'Y' ELSE 'N' END),
    [StagingTimeStamp]           DATETIME2 (2) NULL,
    [TransformTimeStamp]         DATETIME2 (2) NULL,
    [TransformValidValue]        FLOAT (53)    NULL,
    [TransformValidRows]         INT           NULL,
    [TransformValidStatus]       AS            (CASE WHEN [TransformValidRows] = [StagingTotalRows]
                                                          AND CONVERT (BIGINT, [StagingValidValue]) = CONVERT (BIGINT, [TransformValidValue]) THEN 'Y' ELSE CASE WHEN [TransformTimeStamp] IS NULL
                                                                                                                                                                      AND [StagingValidToLoadFlag] = 'Y' THEN 'X' ELSE 'N' END END),
    [ExtractFDMTimeStamp]        DATETIME2 (2) NULL,
    [ExtractFDMValue]            FLOAT (53)    NULL,
    [ExtractFDMRows]             INT           NULL,
    [ExtractFPVTimeStamp]        DATETIME2 (2) NULL,
    [ExtractFPVValue]            FLOAT (53)    NULL,
    [ExtractFPVRows]             INT           NULL,
    [ExtractValidStatus]         AS            (CASE WHEN [TransformValidRows] = [StagingTotalRows]
                                                          AND CONVERT (BIGINT, [StagingValidValue]) = CONVERT (BIGINT, [TransformValidValue])
                                                          AND [ExtractFDMRows] > (100) THEN 'Y' ELSE CASE WHEN [TransformTimeStamp] IS NULL
                                                                                                               AND [StagingValidToLoadFlag] = 'Y' THEN 'X' ELSE 'N' END END),
    [FileMovedAtSourceFlag]      VARCHAR (1)   NULL,
    [FileMovedActionTaken]       VARCHAR (255) NULL,
    [FileMovedTimeStamp]         DATETIME2 (2) NULL,
    [FileMovedDestinationFolder] VARCHAR (255) NULL,
    [FileDeletedLoadId]          INT           NULL,
    [FileDeletedTimeStamp]       DATETIME2 (2) NULL,
    [LoadId]                     INT           NULL,
    [LoadTimeStamp]              DATETIME2 (2) NULL,
    CONSTRAINT [PK_ImportFileLog] PRIMARY KEY CLUSTERED ([FileLogUniqueKey] ASC)
);


GO
PRINT N'Creating [TM1Control].[ImportFileLog].[IX_ImportFileLog]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_ImportFileLog]
    ON [TM1Control].[ImportFileLog]([FileName] ASC, [LoadId] ASC) WITH (IGNORE_DUP_KEY = ON);


GO
PRINT N'Creating [TM1Control].[PlanningCalendar]...';


GO
CREATE TABLE [TM1Control].[PlanningCalendar] (
    [PlanningCalendarUniqueKey]      INT           IDENTITY (1, 1) NOT NULL,
    [PlanningScenarioKey]            INT           NULL,
    [PlanningFileType]               VARCHAR (50)  NULL,
    [PlanningFileTypeKey]            INT           NULL,
    [PlanningYear]                   VARCHAR (50)  NULL,
    [PlanningScenario]               VARCHAR (50)  NULL,
    [PlanningScenarioValidFrom]      DATETIME2 (2) NULL,
    [PlanningScenarioExpected]       VARCHAR (1)   NULL,
    [ScenarioFirstArrivedDate]       DATETIME2 (2) NULL,
    [ScenarioFirstArrivedFileLogKey] INT           NULL,
    [ScenarioLastUpdatedDate]        DATETIME2 (2) NULL,
    [ScenarioLastUpdatedFileLogKey]  INT           NULL,
    [ScenarioLastUpdatedPeriodFrom]  INT           NULL,
    [ScenarioLastUpdatedPeriodTo]    INT           NULL,
    [InsertDateTime]                 DATETIME2 (2) NULL,
    [InsertLoadId]                   INT           NULL,
    CONSTRAINT [PK_PlanningCalendar] PRIMARY KEY CLUSTERED ([PlanningCalendarUniqueKey] ASC)
);


GO
PRINT N'Creating [TM1Control].[PlanningCalendar].[Unique_PlanningCalendar]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [Unique_PlanningCalendar]
    ON [TM1Control].[PlanningCalendar]([PlanningScenario] ASC, [PlanningFileType] ASC, [PlanningYear] ASC) WITH (IGNORE_DUP_KEY = ON);


GO
PRINT N'Creating [TM1Control].[RunMode]...';


GO
CREATE TABLE [TM1Control].[RunMode] (
    [RunModeKey]      INT      IDENTITY (10000, 1) NOT NULL,
    [RunModeValue]    INT      NOT NULL,
    [RunModeType]     AS       (CASE [RunModeValue] WHEN (0) THEN 'Blob Load' WHEN (1) THEN 'Direct File Load' ELSE 'Unknown' END),
    [UpdateTimeStamp] DATETIME NULL
);


GO
PRINT N'Creating [TM1Control].[ImportFileType]...';


GO
CREATE TABLE [TM1Control].[ImportFileType] (
    [PlanningFileTypeUniqueKey]           INT           IDENTITY (1, 1) NOT NULL,
    [PlanningFileTypeName]                VARCHAR (50)  NOT NULL,
    [PlanningFileTypeDescription]         VARCHAR (250) NOT NULL,
    [PlanningFileTypePrefixChars]         VARCHAR (250) NOT NULL,
    [PlanningFileTypeValidLoadChars]      VARCHAR (250) NULL,
    [PlanningFileTypeImportFolderName]    VARCHAR (50)  NOT NULL,
    [PlanningFileTypeFailedFolderName]    VARCHAR (50)  NULL,
    [PlanningFileTypeProcessedFolderName] VARCHAR (50)  NULL,
    [PlanningFileTypeArchiveFolderName]   VARCHAR (50)  NULL,
    [PlanningFileTypeStagingTable]        VARCHAR (50)  NOT NULL,
    [PlanningFileTypeFormat]              VARCHAR (50)  NOT NULL,
    [PlanningFileTypeDelimiter]           VARCHAR (50)  NOT NULL,
    [PlanningFileTypeProcessFlag]         VARCHAR (1)   NOT NULL,
    [PlanningFileTypeRowCheckField]       VARCHAR (50)  NOT NULL,
    [PlanningFileRetentionDays]           INT           NULL,
    [InsertTimeStamp]                     DATETIME2 (2) NOT NULL,
    [InsertLoadId]                        INT           NULL,
    CONSTRAINT [PK_RevenueFileTypeLog] PRIMARY KEY CLUSTERED ([PlanningFileTypeUniqueKey] ASC)
);


GO
PRINT N'Creating [TM1Control].[ImportFileType].[IX_ImportFileType]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_ImportFileType]
    ON [TM1Control].[ImportFileType]([PlanningFileTypeName] ASC) WITH (IGNORE_DUP_KEY = ON);


GO
PRINT N'Creating [TM1Control].[PlanningScenario]...';


GO
CREATE TABLE [TM1Control].[PlanningScenario] (
    [PlanningScenarioUniqueKey] INT           IDENTITY (1, 1) NOT NULL,
    [PlanningScenario]          VARCHAR (255) NULL,
    [PlanningScenarioValidFDM]  VARCHAR (1)   NULL,
    [PlanningScenarioValidFPV]  VARCHAR (1)   NULL,
    [InsertTimeStamp]           DATETIME2 (2) NULL,
    [InsertLoadId]              INT           NULL,
    CONSTRAINT [PK_PlanningScenario] PRIMARY KEY CLUSTERED ([PlanningScenarioUniqueKey] ASC)
);


GO
PRINT N'Creating [TM1Control].[PlanningScenario].[IX_PlanningScenario]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_PlanningScenario]
    ON [TM1Control].[PlanningScenario]([PlanningScenario] ASC) WITH (IGNORE_DUP_KEY = ON);


GO
PRINT N'Creating [TM1Control].[ErrorLog]...';


GO
CREATE TABLE [TM1Control].[ErrorLog] (
    [ErrorLogUniqueKey]    INT           IDENTITY (1, 1) NOT NULL,
    [FileEnvironment]      VARCHAR (50)  NOT NULL,
    [ErrorLogPackageName]  VARCHAR (255) NULL,
    [ErrorLogTaskName]     VARCHAR (255) NULL,
    [ErrorLogUserName]     VARCHAR (255) NULL,
    [ErrorLogSummaryDescr] VARCHAR (255) NULL,
    [ErrorTableName]       VARCHAR (255) NULL,
    [ErrorFilePath]        VARCHAR (255) NOT NULL,
    [ErrorMessage]         VARCHAR (MAX) NOT NULL,
    [ErrorLogLoadId]       INT           NULL,
    [InsertTimeStamp]      DATETIME      NOT NULL,
    CONSTRAINT [PK_ErrorLog] PRIMARY KEY CLUSTERED ([ErrorLogUniqueKey] ASC)
);


GO
PRINT N'Creating [TM1Staging].[PlanningExtractCosts]...';


GO
CREATE TABLE [TM1Staging].[PlanningExtractCosts] (
    [PlanningExtractKey]  INT           IDENTITY (1, 1) NOT NULL,
    [PlanningFileTypeKey] INT           NULL,
    [PlanningScenarioKey] INT           NULL,
    [FileLogUniqueKey]    INT           NULL,
    [Company]             VARCHAR (50)  NULL,
    [BusinessUnit]        VARCHAR (50)  NULL,
    [SubBusinessUnit]     VARCHAR (50)  NULL,
    [Category]            VARCHAR (50)  NULL,
    [Mapping]             VARCHAR (50)  NULL,
    [PlanningAccount]     VARCHAR (50)  NULL,
    [PlanningPeriod]      VARCHAR (50)  NULL,
    [PlanningYear]        VARCHAR (50)  NULL,
    [PlanningScenario]    VARCHAR (50)  NULL,
    [ValueGBP]            FLOAT (53)    NULL,
    [InsertTimeStamp]     DATETIME2 (2) NULL,
    [InsertLoadId]        INT           NULL,
    CONSTRAINT [PK_PlanningExtract] PRIMARY KEY CLUSTERED ([PlanningExtractKey] ASC)
);


GO
PRINT N'Creating [TM1Staging].[PlanningExtractRevenue]...';


GO
CREATE TABLE [TM1Staging].[PlanningExtractRevenue] (
    [PlanningExtractKey]  INT           IDENTITY (1, 1) NOT NULL,
    [PlanningFileTypeKey] INT           NULL,
    [PlanningScenarioKey] INT           NULL,
    [FileLogUniqueKey]    INT           NULL,
    [Company]             VARCHAR (50)  NULL,
    [Class]               VARCHAR (150) NULL,
    [Level4]              VARCHAR (150) NULL,
    [Level3]              VARCHAR (150) NULL,
    [Level2]              VARCHAR (150) NULL,
    [Level1]              VARCHAR (150) NULL,
    [EL1Description]      VARCHAR (150) NULL,
    [EL1Code]             VARCHAR (150) NULL,
    [EL2Description]      VARCHAR (150) NULL,
    [EL2Code]             VARCHAR (150) NULL,
    [PlanningPeriod]      VARCHAR (50)  NULL,
    [PlanningYear]        VARCHAR (50)  NULL,
    [PlanningScenario]    VARCHAR (50)  NULL,
    [ValueGBP]            FLOAT (53)    NULL,
    [InsertTimeStamp]     DATETIME2 (2) NULL,
    [InsertLoadId]        INT           NULL,
    CONSTRAINT [PK_PlanningExtractRevenue] PRIMARY KEY CLUSTERED ([PlanningExtractKey] ASC)
);


GO
PRINT N'Creating [TM1Transform].[PlanningData]...';


GO
CREATE TABLE [TM1Transform].[PlanningData] (
    [PlanningDataKey]        INT           IDENTITY (1, 1) NOT NULL,
    [PlanningScenarioKey]    INT           NULL,
    [PlanningFileLogKey]     INT           NULL,
    [PlanningFileTypeKey]    INT           NULL,
    [PlanningCalendarKey]    INT           NULL,
    [PlanningFilePeriodSeq]  INT           NULL,
    [PlanningPeriodFirstDay] DATETIME2 (2) NULL,
    [Company]                VARCHAR (50)  NULL,
    [Class]                  VARCHAR (150) NULL,
    [Level4]                 VARCHAR (150) NULL,
    [Level3]                 VARCHAR (150) NULL,
    [Level2]                 VARCHAR (150) NULL,
    [Level1]                 VARCHAR (150) NULL,
    [EL1Description]         VARCHAR (150) NULL,
    [EL1Code]                VARCHAR (150) NULL,
    [EL2Description]         VARCHAR (150) NULL,
    [EL2Code]                VARCHAR (150) NULL,
    [PlanningPeriod]         VARCHAR (50)  NULL,
    [PlanningYear]           VARCHAR (50)  NULL,
    [PlanningScenario]       VARCHAR (50)  NULL,
    [ValueGBP]               MONEY         NULL,
    [InsertTimeStamp]        DATETIME2 (2) NULL,
    [InsertLoadId]           INT           NULL
);


GO
PRINT N'Creating [TM1Control].[DF_RevenueFilesLog_FileSource]...';


GO
ALTER TABLE [TM1Control].[ImportFileLog]
    ADD CONSTRAINT [DF_RevenueFilesLog_FileSource] DEFAULT ('TM1Prod') FOR [FileSource];


GO
PRINT N'Creating [TM1Control].[DF_ImportFileLog_SourceFileID]...';


GO
ALTER TABLE [TM1Control].[ImportFileLog]
    ADD CONSTRAINT [DF_ImportFileLog_SourceFileID] DEFAULT ((0)) FOR [SourceFileID];


GO
PRINT N'Creating [TM1Control].[DF_ImportFileLog_StagingValidToLoadFlag]...';


GO
ALTER TABLE [TM1Control].[ImportFileLog]
    ADD CONSTRAINT [DF_ImportFileLog_StagingValidToLoadFlag] DEFAULT ('N') FOR [StagingValidToLoadFlag];


GO
PRINT N'Creating [TM1Control].[DF_RevenueFilesLog_LoadTimeStamp]...';


GO
ALTER TABLE [TM1Control].[ImportFileLog]
    ADD CONSTRAINT [DF_RevenueFilesLog_LoadTimeStamp] DEFAULT (getdate()) FOR [LoadTimeStamp];


GO
PRINT N'Creating [TM1Control].[DF_PlanningCalendar_InsertDateTime]...';


GO
ALTER TABLE [TM1Control].[PlanningCalendar]
    ADD CONSTRAINT [DF_PlanningCalendar_InsertDateTime] DEFAULT (getdate()) FOR [InsertDateTime];


GO
PRINT N'Creating [TM1Control].[DF_CurrentRunMode_RunModeValue]...';


GO
ALTER TABLE [TM1Control].[RunMode]
    ADD CONSTRAINT [DF_CurrentRunMode_RunModeValue] DEFAULT ((0)) FOR [RunModeValue];


GO
PRINT N'Creating [TM1Control].[DF_RunMode_UpdateTimeStamp]...';


GO
ALTER TABLE [TM1Control].[RunMode]
    ADD CONSTRAINT [DF_RunMode_UpdateTimeStamp] DEFAULT (getdate()) FOR [UpdateTimeStamp];


GO
PRINT N'Creating [TM1Control].[DF_RevenueFileType_RevenueFileTypeValidFlag1]...';


GO
ALTER TABLE [TM1Control].[ImportFileType]
    ADD CONSTRAINT [DF_RevenueFileType_RevenueFileTypeValidFlag1] DEFAULT ('Y') FOR [PlanningFileTypeProcessFlag];


GO
PRINT N'Creating [TM1Control].[DF_ImportFileType_RevenueFileRetentionDays]...';


GO
ALTER TABLE [TM1Control].[ImportFileType]
    ADD CONSTRAINT [DF_ImportFileType_RevenueFileRetentionDays] DEFAULT ((30)) FOR [PlanningFileRetentionDays];


GO
PRINT N'Creating [TM1Control].[DF_RevenueFileType_InsertTimeStamp]...';


GO
ALTER TABLE [TM1Control].[ImportFileType]
    ADD CONSTRAINT [DF_RevenueFileType_InsertTimeStamp] DEFAULT (getdate()) FOR [InsertTimeStamp];


GO
PRINT N'Creating [TM1Control].[DF_ImportFileType_InsertLoadId]...';


GO
ALTER TABLE [TM1Control].[ImportFileType]
    ADD CONSTRAINT [DF_ImportFileType_InsertLoadId] DEFAULT ((99999)) FOR [InsertLoadId];


GO
PRINT N'Creating [TM1Control].[DF_RevenueFileType_RevenueFileTypeDelimiter]...';


GO
ALTER TABLE [TM1Control].[ImportFileType]
    ADD CONSTRAINT [DF_RevenueFileType_RevenueFileTypeDelimiter] DEFAULT (',') FOR [PlanningFileTypeDelimiter];


GO
PRINT N'Creating [TM1Control].[DF_RevenueFileType_RevenueFileTypeFormat]...';


GO
ALTER TABLE [TM1Control].[ImportFileType]
    ADD CONSTRAINT [DF_RevenueFileType_RevenueFileTypeFormat] DEFAULT ('CSV') FOR [PlanningFileTypeFormat];


GO
PRINT N'Creating [TM1Control].[DF_PlanningScenario_InsertTimeStamp]...';


GO
ALTER TABLE [TM1Control].[PlanningScenario]
    ADD CONSTRAINT [DF_PlanningScenario_InsertTimeStamp] DEFAULT (getdate()) FOR [InsertTimeStamp];


GO
PRINT N'Creating [TM1Control].[DF_ErrorLog_InsertTimeStamp]...';


GO
ALTER TABLE [TM1Control].[ErrorLog]
    ADD CONSTRAINT [DF_ErrorLog_InsertTimeStamp] DEFAULT (getdate()) FOR [InsertTimeStamp];


GO
PRINT N'Creating [TM1Staging].[DF_Planning_Extract_InsertTimeStamp]...';


GO
ALTER TABLE [TM1Staging].[PlanningExtractCosts]
    ADD CONSTRAINT [DF_Planning_Extract_InsertTimeStamp] DEFAULT (getdate()) FOR [InsertTimeStamp];


GO
PRINT N'Creating [TM1Staging].[DF_PlanningExtractRevenue_InsertTimeStamp]...';


GO
ALTER TABLE [TM1Staging].[PlanningExtractRevenue]
    ADD CONSTRAINT [DF_PlanningExtractRevenue_InsertTimeStamp] DEFAULT (getdate()) FOR [InsertTimeStamp];


GO
PRINT N'Creating [TM1Staging].[DF_PlanningExtractRevenue_InsertLoadId]...';


GO
ALTER TABLE [TM1Staging].[PlanningExtractRevenue]
    ADD CONSTRAINT [DF_PlanningExtractRevenue_InsertLoadId] DEFAULT ((12345)) FOR [InsertLoadId];


GO
PRINT N'Creating [TM1Transform].[DF_PlanningData_InsertTimeStamp]...';


GO
ALTER TABLE [TM1Transform].[PlanningData]
    ADD CONSTRAINT [DF_PlanningData_InsertTimeStamp] DEFAULT (getdate()) FOR [InsertTimeStamp];


GO
PRINT N'Creating [TM1Control].[BatchLoadSummary]...';


GO



CREATE view [TM1Control].[BatchLoadSummary]
as
with cte_Summarise
as
(
SELECT TOP 100 PERCENT
    [LoadId]
	,count([FileLogUniqueKey]) as FilesAttemptedforProcess

      ,sum(case when [StagingValidStatus] = 'N' then 1 else 0 end) as StagingNotValid
      ,sum(case when [StagingValidStatus] = 'Y' then 1 else 0 end) as StagingSuccess

      ,sum(case when [TransformValidStatus] = 'N' then 1 else 0 end) as TransformNotValid
      ,sum(case when [TransformValidStatus] = 'Y' then 1 else 0 end) as TransformSuccess

      ,sum(case when [ExtractValidStatus] = 'N' then 1 else 0 end) as ExtractNotValid
      ,sum(case when [ExtractValidStatus] = 'Y' then 1 else 0 end) as ExtractSuccess

  FROM [TM1Control].[ImportFileLog]
  WHERE [StagingValidToLoadFlag] = 'Y'

 GROUP BY [LoadId]
)
SELECT [LoadId] as BatchId
		--Note : Cost File without a Valid Revenue file will not permit Extacting
	   ,case when [FilesAttemptedforProcess] = [ExtractSuccess] then 'Batch Success, Processed ' + cast([ExtractSuccess] as varchar(5)) + ' Files' 	
			else case when [ExtractNotValid] > 0 then 
			'Batch Review, Extract Not Valid / File Not Used for ' + cast([ExtractNotValid]	 as varchar(5)) + ' File(s)'
			else case when [TransformNotValid] > 0 then 
			'Batch Error, Transform Not Valid for ' + cast([TransformNotValid] as varchar(5)) + ' File(s)'
			else case when [StagingNotValid] > 0 then 
			'Batch Error, Staging Not Valid for ' + cast([StagingNotValid] as varchar(5)) + ' File(s)'
	   end end end end as BatchSummaryMessage
      ,[FilesAttemptedforProcess]
      ,[StagingNotValid]
      ,[StagingSuccess]
      ,[TransformNotValid]
      ,[TransformSuccess]
      ,[ExtractNotValid]
      ,[ExtractSuccess]
  FROM cte_Summarise
GO
PRINT N'Creating [TM1Control].[BatchLastCalendarArrival]...';


GO
CREATE VIEW [TM1Control].[BatchLastCalendarArrival]
as

SELECT  TOP 50
      
      cast([PlanningYear] as char(4))+ ' ' + py.[PlanningScenario]   as Scenario
      ,[ScenarioFirstArrivedDate]
	  ,case isnull(datediff(DAY, [ScenarioFirstArrivedDate], getdate()),0) when 1 then 'Y' when 2 then 'Y' when 3 then 'Y'  when 0 then 'X' else 'N' end AlertMe
      ,[ScenarioLastUpdatedDate]
 
  FROM [TM1Control].[PlanningCalendar] py
  JOIN [TM1Control].[PlanningScenario] ps on py.PlanningScenarioKey = ps.PlanningScenarioUniqueKey
  WHERE PlanningYear >= year(getdate())-1 and PlanningYear< year(getdate())+2
  and [PlanningFileType] = 'Revenue' and [PlanningScenarioValidFDM] = 'Y'
  order by 1
GO
PRINT N'Creating [TM1Control].[DataCheckTransform]...';


GO



CREATE VIEW [TM1Control].[DataCheckTransform]
AS

SELECT
       ods.[Company]
	  ,ift.PlanningFileTypeName as RevenueFileTypeName
      ,ods.Level2 as FinanceSection
      ,ods.[PlanningScenario]
      ,ods.[PlanningYear]
	  ,sum([ValueGBP]) as ScenarioYearValue
	  ,ods.[InsertLoadId] as StagingLoadId
	  ,ifl.[FileName] as StagingFileName

  FROM [TM1Transform].[PlanningData] ods

JOIN [TM1Control].[ImportFileLog] ifl on ods.PlanningFileLogKey = ifl.[FileLogUniqueKey]
JOIN [TM1Control].[PlanningScenario] ps on ods.PlanningScenarioKey = ps.PlanningScenarioUniqueKey
JOIN [TM1Control].[ImportFileType] ift on ods.PlanningFileTypeKey = ift.PlanningFileTypeUniqueKey

WHERE [PlanningScenarioValidFDM] = 'Y'

GROUP BY
       ods.[Company]
	  ,ift.PlanningFileTypeName
      ,ods.Level2 
      ,ods.[PlanningScenario]
      ,ods.[PlanningYear]
	  ,ods.[InsertLoadId] 
	  ,ifl.[FileName]
GO
PRINT N'Creating [TM1Control].[DataCheckStagingCosts]...';


GO

   --    ,pec.[BusinessUnit] as Class
   --   ,pec.[SubBusinessUnit] as Level4
   --   ,pec.[Category] as Level3
   --   ,pec.[Mapping] as Level2
	  --,'Costs' as Level1

CREATE VIEW [TM1Control].[DataCheckStagingCosts]
AS

SELECT  
       pec.[Company]
	  ,ift.PlanningFileTypeName as RevenueFileTypeName
      ,pec.Mapping as FinanceSection
      ,pec.[PlanningScenario]
      ,pec.[PlanningYear]
	  ,sum([ValueGBP]) as ScenarioYearValue
	  ,pec.[InsertLoadId] as StagingLoadId
	  ,ifl.[FileName] as StagingFileName

  FROM [TM1Staging].[PlanningExtractCosts] pec

JOIN [TM1Control].[ImportFileLog] ifl on pec.FileLogUniqueKey = ifl.[FileLogUniqueKey]
JOIN [TM1Control].[PlanningScenario] ps on pec.PlanningScenarioKey = ps.PlanningScenarioUniqueKey
JOIN [TM1Control].[ImportFileType] ift on pec.PlanningFileTypeKey = ift.PlanningFileTypeUniqueKey

WHERE [PlanningScenarioValidFDM] = 'Y'

GROUP BY 
	   pec.[Company]
	  ,ift.PlanningFileTypeName
      ,pec.Mapping
      ,pec.[PlanningScenario]
      ,pec.[PlanningYear]
      ,pec.[InsertLoadId]
	  ,ifl.[FileName]
GO
PRINT N'Creating [TM1Control].[DataCheckStagingRevenue]...';


GO

 CREATE VIEW [TM1Control].[DataCheckStagingRevenue]
AS

SELECT  
       pec.[Company]
	  ,ift.PlanningFileTypeName as RevenueFileTypeName
      ,pec.Level2 as FinanceSection
      ,pec.[PlanningScenario]
      ,pec.[PlanningYear]
	  ,sum([ValueGBP]) as ScenarioYearValue
	  ,pec.[InsertLoadId] as StagingLoadId
	  ,ifl.[FileName] as StagingFileName

  FROM [TM1Staging].[PlanningExtractRevenue] pec

JOIN [TM1Control].[ImportFileLog] ifl on pec.FileLogUniqueKey = ifl.[FileLogUniqueKey]
JOIN [TM1Control].[PlanningScenario] ps on pec.PlanningScenarioKey = ps.PlanningScenarioUniqueKey
JOIN [TM1Control].[ImportFileType] ift on pec.PlanningFileTypeKey = ift.PlanningFileTypeUniqueKey

WHERE [PlanningScenarioValidFDM] = 'Y'

GROUP BY 
	   pec.[Company]
	  ,ift.PlanningFileTypeName
      ,pec.Level2
      ,pec.[PlanningScenario]
      ,pec.[PlanningYear]
      ,pec.[InsertLoadId]
	  ,ifl.[FileName]
GO
PRINT N'Creating [TM1Control].[BatchRowSummary]...';


GO




CREATE VIEW [TM1Control].[BatchRowSummary]
AS
SELECT 

 [LoadId]
,FileLogUniqueKey as FileKey
,[DerivedFileType]
,[FileName]
,[FileStartPeriodString]
,[FileEndPeriodString]
,[FileRawRowCount]
,[FileModifiedTimeStamp]
,isnull([StagingTotalRows],0) as [StagingTotalRows] 
,isnull([StagingValidStatus], 'Unknown') as [StagingValidStatus]
,isnull([TransformValidRows],0) as [TransformValidRows]
,isnull([TransformValidStatus], 'Unknown') as [TransformValidStatus]
,isnull([ExtractFDMRows],0) as [ExtractFDMRows]
,isnull([ExtractFPVRows],0) as [ExtractFPVRows]
,isnull([ExtractValidStatus], getdate()) as [ExtractValidStatus]
 FROM [TM1Control].[ImportFileLog]
GO
PRINT N'Creating [TM1Control].[BatchMoveSummary]...';


GO





 
CREATE VIEW [TM1Control].[BatchMoveSummary]
as

SELECT 

 [LoadId]
,FileLogUniqueKey as FileKey
,[DerivedFileType]
,isnull([FileMovedActionTaken],'No Move') as [FileMovedActionTaken]
,isnull([FileName],'No Move') as [FileName]
,isnull([FileMovedTimeStamp],getdate()) as [FileMovedTimeStamp]

 FROM [TM1Control].[ImportFileLog]

 UNION

 SELECT 

max([FileDeletedLoadId]) as [LoadId]
,max(FileLogUniqueKey) as FileKey
,max([DerivedFileType]) as [DerivedFileType]
,'Deleted' as [FileMovedActionTaken]
,isnull([FileName],'Unknown') as [FileName]
,max([FileDeletedTimeStamp]) as [FileMovedTimeStamp]

 FROM [TM1Control].[ImportFileLog]
 WHERE [FileDeletedLoadId] is not null
 GROUP BY isnull([FileName],'Unknown')
GO
PRINT N'Creating [TM1Control].[SendBatchEmail001]...';


GO



CREATE PROCEDURE [TM1Control].[SendBatchEmail001]
  @recipientsSTR NVARCHAR(MAX),
  @profilenameSTR NVARCHAR(MAX),
  @intBatchID INT
AS
BEGIN

--------------------------------------------------------------------------
--Created By : Tim Firmin 2018APR17 ~ BI TM1-Hector2-FDM Project
--Sends out HTML Email with Batch Summary of Last ETL Run
--Last Change : Tim Firmin 2018APR17 - Inserted Warning re Row Validation
--Test001 SingleUser	 : EXEC  [TM1control].[SendBatchEmail001] @recipientsSTR = 'tim.firmin@prsformusic.com', @profilenameSTR = 'AZI-MS-SQL-D002 SQL Database Mail', @intBatchID = 58438    
--------------------------------------------------------------------------
	
DECLARE @tableHTML  NVARCHAR(MAX) ;	
DECLARE @subjectSTR  NVARCHAR(MAX) ;	
DECLARE @environmentSTR  NVARCHAR(MAX) ;	

SET @tableHTML =
 N'<H3>TM1 BI Data Integration Last Batch Summary Report : ' + cast(@intBatchID as varchar(10)) + '</H3>' + 
    
--Summary Row

	N'<table style="border:3px dashed black;font-family:arial;">' +
    N'<font color="black" size="3" face="Verdana">
	<tr></tr>' +
    CAST ( ( SELECT		
						'td/@bgcolor'=CASE left([BatchSummaryMessage],11) WHEN 'Batch Error' THEN 'Tomato' WHEN 'Batch Revie' THEN 'Orange' ELSE 'SpringGreen' END,																																	           
					td = t1.[BatchSummaryMessage], ''
               FROM [TM1Control].[BatchLoadSummary] t1 WHERE [BatchId] = @intBatchID
              FOR XML PATH('tr'), TYPE 
    ) AS NVARCHAR(MAX) ) +
    N'</font></table>'  +
	  N'<h5 ><span style="background-color: #FFFF00">Table 1 : TM1 Integrate ~ Summary of Files Loaded</span></h5>' + 
--Table One part 1
	N'<table style="border:1px dashed black;font-family:arial;">' +
    N'<font color="black" size="1" face="Verdana">
	<tr><th>FileKey</th><th>DerivedFileType</th><th>FileName</th><th> </th><th>FileStartPeriod</th><th>FileEndPeriod</th>
	<th> </th><th>RawRowCount</th><th>FileModified</th><th>StagingRows</th><th>StagingStatus</th>
	<th> </th><th>TransformRows</th><th>TransformStatus</th><th> </th><th>ExtractFDMRows</th><th>ExtractFPVRows</th></tr>' +
    CAST ( ( SELECT																																								           
					td = t1.[FileKey], '',    
					td = t1.[DerivedFileType], '',
					td = t1.[FileName], '',
					td = '|', '', 
					td = t1.[FileStartPeriodString], '',
					td = t1.[FileEndPeriodString], '',
					td = '|', '', 
					td = t1.[FileRawRowCount], '',   
					td = t1.[FileModifiedTimeStamp], '',
					td = t1.[StagingTotalRows], '',

					'td/@bgcolor'=CASE WHEN [StagingValidStatus]<>'Y' THEN 'Tomato' ELSE 'SpringGreen' END,
					td = t1.[StagingValidStatus], '',
					td = '|', '', 
					td = t1.[TransformValidRows], '',

					'td/@bgcolor'=CASE WHEN [TransformValidStatus]<>'Y' THEN 'Tomato' ELSE 'SpringGreen' END,
					td = t1.[TransformValidStatus], '',
					td = '|', '', 
					td = t1.[ExtractFDMRows], '',
					td = t1.[ExtractFPVRows], ''
               FROM [TM1Control].[BatchRowSummary] t1 WHERE [LoadId] = @intBatchID
              FOR XML PATH('tr'), TYPE 
    ) AS NVARCHAR(MAX) ) +
    N'</font></table><br>'  +

    N'<h5 ><span style="background-color: #FFFF00">Table 2 : TM1 Integrate ~ Summary of File Management</span></h5>' + 

N'<table style="border:1px dashed black;font-family:arial;">' +
    N'<font color="black" size="1" face="Verdana"><tr><th>FileKey</th><th>DerivedFileType</th><th>FileName</th><th> </th><th>FileMovedActionTaken</th><th>FileMovedTimeStamp</th></tr>' +
    CAST ( ( SELECT																								                            																																																													         																														           
					td = t1.[FileKey], '',    
					td = t1.[DerivedFileType], '',
					td = t1.[FileName], '',
					td = '|', '', 
					'td/@bgcolor'=CASE ([FileMovedActionTaken]) WHEN 'Deleted' THEN 'Tomato' WHEN 'Archived' THEN 'Orange' WHEN 'No Move' THEN 'Pink' ELSE 'SpringGreen' END,
					td = t1.[FileMovedActionTaken], '',
					td = t1.[FileMovedTimeStamp], ''
					--Add stuff in for Quarantine	

               FROM [TM1Control].[BatchMoveSummary] t1 WHERE [LoadId] = @intBatchID
              FOR XML PATH('tr'), TYPE 
    ) AS NVARCHAR(MAX) ) +
    N'</font></table>' +




	   N'<h5 ><span style="background-color: #FFFF00">Table 3 : TM1 Integrate ~ Last Core Planning Scenario TimeStamps</span></h5>' + 
	   N'<table style="border:1px dashed black;">' +
       N'<font color="black" size="1" face="Verdana"><tr><th>PlanningScenario</th><th> </th><th>FirstArrived</th><th>LastRefreshed</th></tr>' +
    CAST ( ( SELECT  
					td = t1.Scenario, '',
					td = '|', '',  
					'td/@bgcolor'=CASE AlertMe WHEN 'Y' THEN 'Orange' WHEN 'N' THEN 'SpringGreen' ELSE 'White' END,
					td = t1.ScenarioFirstArrivedDate, '', 
					td = t1.ScenarioLastUpdatedDate, ''

              FROM [TM1Control].[BatchLastCalendarArrival] t1 order by 1 
              FOR XML PATH('tr'), TYPE 
    ) AS NVARCHAR(MAX) ) +
    N'</font></table>' +



	                 '<H4>End of Batch Summary Email for ' + cast(@intBatchID as varchar(10)) + ' [' + LEFT(CONVERT(VARCHAR, GETDATE(), 120), 16) + ']<br></H4>
                <h5 align="right">TJF 2018APR16 v01</h5><br>' 
--PRINT @tableHTML

SET @environmentSTR = 
	CASE @profilenameSTR
		WHEN 'AZI-MS-SQL-D002 SQL Database Mail' then 'DEV'
		WHEN 'AZI-MS-SIS-D002 SQL Database Mail' then 'DEV'
		WHEN 'AZI-MS-SQL-T001 SQL Database Mail' then 'Test'
		WHEN 'AZI-MS-SIS-T001 SQL Database Mail' then 'Test'
		WHEN 'AZI-MS-SQL-U001 SQL Database Mail' then 'UAT'
		WHEN 'AZI-MS-SIS-U001 SQL Database Mail' then 'UAT'
		WHEN 'AZI-MS-SQL-P001 SQL Database Mail' then 'PRD'
		WHEN 'AZI-MS-SIs-P001 SQL Database Mail' then 'PRD'
	END

SET @subjectSTR = 'TM1 Integration [' + @environmentSTR + '] End of Batch Email ID : ' + cast(@intBatchID as varchar(10)) + ' Date : ' + LEFT(CONVERT(VARCHAR, GETDATE(), 120), 16)



EXEC msdb.dbo.sp_send_dbmail @recipients=@recipientsSTR, --'tim.firmin@prsformusic.com; Vandana.Bangera@prsformusic.com, Ian.Norman@prsformusic.com'
@subject = @subjectSTR,
@profile_name = @profilenameSTR,
@body = @tableHTML,
@body_format = 'HTML'

END
GO
PRINT N'Creating [TM1Control].[SendFirstFailEmail001]...';


GO

CREATE PROCEDURE [TM1control].[SendFirstFailEmail001]
  @recipientsSTR NVARCHAR(MAX),
  @profilenameSTR NVARCHAR(MAX),
  @htmlIN NVARCHAR(MAX),
  @intBatchID INT
AS
BEGIN

--------------------------------------------------------------------------
--Created By : Tim Firmin 2017SEP21 ~ BI Turquoise JV Project
--Sends out HTML Email with First Error Description from SSISDB
--Last Change : Tim Firmin 2017OCT03
--Test001 SingleUser	 : EXEC  [TM1control].[SendFirstFailEmail001] @recipientsSTR = 'tim.firmin@prsformusic.com', @profilenameSTR = 'AZI-MS-SQL-D002 SQL Database Mail', @htmlIN = '<H3>ETL.BIT.ExtractAndReport <br> BITExtract.ExtractTransformToDataMart.dtsx <br> Oct  3 2017  2:35PM <br> FST109 Move Files To Archive Folder:Error: An error occurred with the following error message: "Could not find file \\ONP-MS-FSS-DV01\Data\Proj\Turquoise\Dev\FinancialFiles\InProcess\VATCreditNoteFiles\In\VATCreditNote_PRS_19092017_007.csv.".  </H3>',  @intBatchID = 39518
--------------------------------------------------------------------------

DECLARE @tableHTML  NVARCHAR(MAX) ;	
DECLARE @subjectSTR  NVARCHAR(MAX) ;	

SET @tableHTML =
 N'<h4 ><span style="background-color: #FFFF00">SSIS Failure found for Batch ID : ' + cast(@intBatchID as varchar(10)) + ' [' + LEFT(CONVERT(VARCHAR, GETDATE(), 120), 16) + '] First Error Shown Below..<br></span></h4>' + 
+ @htmlIN

SET @subjectSTR = 'TM1FDM Integration SSIS (1st) Fail Error Batch ID : ' + cast(@intBatchID as varchar(10)) + ' Date : ' + LEFT(CONVERT(VARCHAR, GETDATE(), 120), 16)

EXEC msdb.dbo.sp_send_dbmail @recipients=@recipientsSTR, --'tim.firmin@prsformusic.com; Vandana.Bangera@prsformusic.com, Ian.Norman@prsformusic.com'
@subject = @subjectSTR,
@profile_name = @profilenameSTR,
@body = @tableHTML,
@body_format = 'HTML'

END
GO
PRINT N'Creating [TM1Control].[SendEmptyBatchEmail001]...';


GO


CREATE PROCEDURE [TM1control].[SendEmptyBatchEmail001]
  @recipientsSTR NVARCHAR(MAX),
  @profilenameSTR NVARCHAR(MAX),
  @intBatchID INT
AS
BEGIN

--------------------------------------------------------------------------
--Created By : Tim Firmin 2017SEP21 ~ BI Turquoise JV Project
--Sends out HTML Email with Batch Summary of Last ETL Run
--Last Change : Tim Firmin 2017SEP21 - Inserted Warning re Row Validation
--Test001 SingleUser	 : EXEC  [TM1control].[SendEmptyBatchEmail001] @recipientsSTR = 'tim.firmin@prsformusic.com', @profilenameSTR = 'AZI-MS-SQL-D002 SQL Database Mail', @intBatchID = 39518
--------------------------------------------------------------------------

DECLARE @tableHTML  NVARCHAR(MAX) ;	
DECLARE @subjectSTR  NVARCHAR(MAX) ;	

SET @tableHTML =
    N'<H3>TM1FDM End of Batch Summary Report : ' + cast(@intBatchID as varchar(10)) + '</H3>' + 
    N'<h4 ><span style="background-color: #FFFF00">No Files Were Processed for Batch Run ID : ' + cast(@intBatchID as varchar(10)) + ' [' + LEFT(CONVERT(VARCHAR, GETDATE(), 120), 16) + ']<br></span></h4>' + 

    N'<h5 align="right">TJF 2018APR12 v01</h5><br>' 
--PRINT @tableHTML

SET @subjectSTR = 'TM1FDM Batch Run with No Activity ID : ' + cast(@intBatchID as varchar(10)) + ' Date : ' + LEFT(CONVERT(VARCHAR, GETDATE(), 120), 16)

EXEC msdb.dbo.sp_send_dbmail @recipients=@recipientsSTR, --'tim.firmin@prsformusic.com; Vandana.Bangera@prsformusic.com, Ian.Norman@prsformusic.com'
@subject = @subjectSTR,
@profile_name = @profilenameSTR,
@body = @tableHTML,
@body_format = 'HTML'

END
GO
PRINT N'Creating [TM1Control].[PostDeploymentMetadata]...';


GO

--------------------------------------------------------------------------
--Created By : Tim Firmin 2018APR16 ~ TM1 Extact H2 Project
--Ensure working metadata available for execution
--Last Change : Tim Firmin 2018APR16 - 
--Test001 : EXEC [TM1Control].[PostDeploymentMetadata]   @pFilePath = '\\ONP-MS-FSS-DV01\Data\Proj\Hector2\Dev\'
--Test002 :
--------------------------------------------------------------------------

CREATE PROCEDURE [TM1Control].[PostDeploymentMetadata]
  @pLoadId int --   '[SourceFileName] = 'DistributionFilePRS_Extract_30062017'
AS
BEGIN

--insert [[PlanningScenario]]
SET IDENTITY_INSERT [TM1Control].[PlanningScenario] ON 
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenarioUniqueKey], [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( -1, N'Unknown', N'N', N'N', CAST(GetDate() AS DateTime2), @pLoadId)
SET IDENTITY_INSERT [TM1Control].[PlanningScenario] OFF

INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'5YRP Baseline', N'N', N'N', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'5YRP Revised', N'N', N'N', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'Actual', N'Y', N'N', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'Budget', N'Y', N'Y', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'Forecast Q1', N'Y', N'Y', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'Forecast Q2', N'Y', N'Y', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'Forecast Q3', N'Y', N'Y', CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningScenario] ( [PlanningScenario], [PlanningScenarioValidFDM], [PlanningScenarioValidFPV], [InsertTimeStamp], [InsertLoadId]) VALUES ( N'Rolling', N'N', N'N', CAST(GetDate() AS DateTime2), @pLoadId)

--insert file types

SET IDENTITY_INSERT [TM1Control].[ImportFileType] ON 
INSERT [TM1Control].[ImportFileType] ( [PlanningFileTypeUniqueKey], [PlanningFileTypeName], [PlanningFileTypeDescription], [PlanningFileTypePrefixChars], [PlanningFileTypeValidLoadChars], [PlanningFileTypeImportFolderName], [PlanningFileTypeFailedFolderName], [PlanningFileTypeProcessedFolderName], [PlanningFileTypeArchiveFolderName], [PlanningFileTypeStagingTable], [PlanningFileTypeFormat], [PlanningFileTypeDelimiter], [PlanningFileTypeProcessFlag], [PlanningFileTypeRowCheckField], [PlanningFileRetentionDays], [InsertTimeStamp], [InsertLoadId]) VALUES (-1, N'Unknown', N'Unknown', N'Unknown', N'TM1 Prod Server', N'Unknown', N'Unknown', N'Unknown', N'Unknown', N'Unknowns', N'CMA', N',', N'N', N'Unknown', 0, CAST(Getdate() AS DateTime2), @pLoadId)
SET IDENTITY_INSERT [TM1Control].[ImportFileType] OFF

INSERT [TM1Control].[ImportFileType] ( [PlanningFileTypeName], [PlanningFileTypeDescription], [PlanningFileTypePrefixChars], [PlanningFileTypeValidLoadChars], [PlanningFileTypeImportFolderName], [PlanningFileTypeFailedFolderName], [PlanningFileTypeProcessedFolderName], [PlanningFileTypeArchiveFolderName], [PlanningFileTypeStagingTable], [PlanningFileTypeFormat], [PlanningFileTypeDelimiter], [PlanningFileTypeProcessFlag], [PlanningFileTypeRowCheckField], [PlanningFileRetentionDays], [InsertTimeStamp], [InsertLoadId]) VALUES (N'Costs', N'TM1 Costs Ext', N'01CostDataExtract CR2 Pd', N'TM1 Prod Server', N'01CostDataExtract', N'FilesFailed\01Cost', N'FilesProcessed\01Cost', N'FilesArchive\01Cost', N'TM1Staging.PlanningExtractCosts', N'CMA', N',', N'Y', N'ValueGBP', 20, CAST(Getdate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[ImportFileType] ( [PlanningFileTypeName], [PlanningFileTypeDescription], [PlanningFileTypePrefixChars], [PlanningFileTypeValidLoadChars], [PlanningFileTypeImportFolderName], [PlanningFileTypeFailedFolderName], [PlanningFileTypeProcessedFolderName], [PlanningFileTypeArchiveFolderName], [PlanningFileTypeStagingTable], [PlanningFileTypeFormat], [PlanningFileTypeDelimiter], [PlanningFileTypeProcessFlag], [PlanningFileTypeRowCheckField], [PlanningFileRetentionDays], [InsertTimeStamp], [InsertLoadId]) VALUES (N'Revenue', N'TM1 Revenue Data', N'02RevenueDataExtract_Pd', N'TM1 Prod Server', N'02RevenueDataExtract', N'FilesFailed\02Revenue', N'FilesProcessed\02Revenue', N'FilesArchive\02Revenue', N'TM1Staging.PlanningExtractRevenue', N'CMA', N',', N'Y', N'ValueGBP', 20, CAST(Getdate() AS DateTime2), @pLoadId)

--insert [PlanningCalendar]
SET IDENTITY_INSERT [TM1Control].[PlanningCalendar] ON 
INSERT [TM1Control].[PlanningCalendar] ( [PlanningCalendarUniqueKey],  [PlanningScenarioKey],  [PlanningFileType],  [PlanningFileTypeKey],  [PlanningYear],  [PlanningScenario],  [PlanningScenarioValidFrom],  [PlanningScenarioExpected],  [ScenarioFirstArrivedDate],  [ScenarioFirstArrivedFileLogKey],  [ScenarioLastUpdatedDate],  [ScenarioLastUpdatedFileLogKey],  [ScenarioLastUpdatedPeriodFrom],  [ScenarioLastUpdatedPeriodTo], [InsertLoadId])  VALUES ( -1,  -1, N'Unknown',  -1, 9999,  N'Unknown',  NULL,  N'N', NULL,    NULL,   NULL,  NULL, NULL,  NULL, @pLoadId)
SET IDENTITY_INSERT [TM1Control].[PlanningCalendar] OFF

INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Costs', 7, N'2016', N'Budget', CAST(N'2015-11-30T00:00:00.0000000' AS DateTime2), N'Y', CAST(N'2018-04-11T13:56:23.5200000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Costs', 7, N'2016', N'Forecast Q1', CAST(N'2016-06-30T00:00:00.0000000' AS DateTime2), N'Y', CAST(N'2018-04-11T13:56:23.5200000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Costs', 7, N'2016', N'Forecast Q2', CAST(N'2016-08-30T00:00:00.0000000' AS DateTime2), N'Y', CAST(N'2018-04-11T13:56:23.5200000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Costs', 7, N'2016', N'Forecast Q3', CAST(N'2016-10-30T00:00:00.0000000' AS DateTime2), N'Y', CAST(N'2018-04-11T13:56:23.5200000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Costs', 7, N'2017', N'Budget', CAST(N'2016-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Costs', 7, N'2017', N'Forecast Q1', CAST(N'2017-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Costs', 7, N'2017', N'Forecast Q2', CAST(N'2017-08-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Costs', 7, N'2017', N'Forecast Q3', CAST(N'2017-10-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Costs', 7, N'2018', N'Budget', CAST(N'2017-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Costs', 7, N'2018', N'Forecast Q1', CAST(N'2018-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Costs', 7, N'2018', N'Forecast Q2', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Costs', 7, N'2018', N'Forecast Q3', CAST(N'2018-10-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Costs', 7, N'2019', N'Budget', CAST(N'2018-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Costs', 7, N'2019', N'Forecast Q1', CAST(N'2019-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Costs', 7, N'2019', N'Forecast Q2', CAST(N'2019-08-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Costs', 7, N'2019', N'Forecast Q3', CAST(N'2019-10-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Revenue', 8, N'2016', N'Budget', CAST(N'2015-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Revenue', 8, N'2016', N'Forecast Q1', CAST(N'2016-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Revenue', 8, N'2016', N'Forecast Q2', CAST(N'2016-08-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Revenue', 8, N'2016', N'Forecast Q3', CAST(N'2016-10-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Revenue', 8, N'2017', N'Budget', CAST(N'2016-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Revenue', 8, N'2017', N'Forecast Q1', CAST(N'2017-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Revenue', 8, N'2017', N'Forecast Q2', CAST(N'2017-08-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Revenue', 8, N'2017', N'Forecast Q3', CAST(N'2017-10-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Revenue', 8, N'2018', N'Budget', CAST(N'2017-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Revenue', 8, N'2018', N'Forecast Q1', CAST(N'2018-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Revenue', 8, N'2018', N'Forecast Q2', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 4, N'Revenue', 8, N'2019', N'Budget', CAST(N'2018-11-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 5, N'Revenue', 8, N'2019', N'Forecast Q1', CAST(N'2019-06-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 6, N'Revenue', 8, N'2019', N'Forecast Q2', CAST(N'2019-08-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Revenue', 8, N'2019', N'Forecast Q3', CAST(N'2019-10-30T00:00:00.0000000' AS DateTime2), N'Y', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 1, N'Revenue', 8, N'2018', N'5YRP Baseline', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 2, N'Revenue', 8, N'2018', N'5YRP Revised', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Revenue', 8, N'2018', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 7, N'Revenue', 8, N'2018', N'Forecast Q3', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Revenue', 8, N'2018', N'Rolling', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Costs', 7, N'2018', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 1, N'Revenue', 8, N'2019', N'5YRP Baseline', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 2, N'Revenue', 8, N'2019', N'5YRP Revised', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Revenue', 8, N'2019', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Revenue', 8, N'2019', N'Rolling', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Costs', 7, N'2019', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 1, N'Revenue', 8, N'2016', N'5YRP Baseline', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 2, N'Revenue', 8, N'2016', N'5YRP Revised', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Revenue', 8, N'2016', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Revenue', 8, N'2016', N'Rolling', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Costs', 7, N'2016', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 1, N'Revenue', 8, N'2017', N'5YRP Baseline', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 2, N'Revenue', 8, N'2017', N'5YRP Revised', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Revenue', 8, N'2017', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Revenue', 8, N'2017', N'Rolling', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 3, N'Costs', 7, N'2017', N'Actual', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Costs', 7, N'2016', N'Rolling ', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Costs', 7, N'2017', N'Rolling ', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Costs', 7, N'2018', N'Rolling ', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], [PlanningScenarioValidFrom], [PlanningScenarioExpected], [ScenarioFirstArrivedDate], [ScenarioFirstArrivedFileLogKey], [ScenarioLastUpdatedDate], [ScenarioLastUpdatedFileLogKey], [ScenarioLastUpdatedPeriodFrom], [ScenarioLastUpdatedPeriodTo], [InsertDateTime], InsertLoadId) VALUES ( 8, N'Costs', 7, N'2019', N'Rolling ', NULL, N'N', NULL, NULL, NULL, NULL, NULL, NULL, CAST(GetDate() AS DateTime2), @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2020,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2020,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2020,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2020,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2020,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2020,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2020,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2020,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2020,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2020,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2020,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2020,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2020,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2020,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2020,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2021,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2021,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2021,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2021,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2021,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2021,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2021,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2021,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2021,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2021,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2021,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2021,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2021,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2021,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2022,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2022,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2022,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2022,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2022,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2022,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2022,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2022,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2022,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2022,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2022,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2022,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2022,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2022,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2013,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2013,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2013,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2013,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2013,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2013,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2013,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2013,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2013,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2013,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2013,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2013,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2013,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2013,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2013,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2014,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2014,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2014,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2014,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2014,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2014,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2014,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2014,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2014,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2014,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2014,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2014,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2014,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2014,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2015,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2015,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2015,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2015,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2015,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2015,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2015,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2015,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2015,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2015,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2015,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2015,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2015,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2015,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2010,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2010,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2010,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2010,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2010,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2010,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2010,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2010,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2010,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2010,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2010,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2010,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2010,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2010,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2010,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2011,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2011,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2011,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2011,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2011,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2011,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2011,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2011,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2011,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2011,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2011,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2011,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2011,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2011,'Rolling', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (1,'Revenue',8,2012,'5YRP Baseline', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (2,'Revenue',8,2012,'5YRP Revised', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Costs',7,2012,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (3,'Revenue',8,2012,'Actual', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Costs',7,2012,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (4,'Revenue',8,2012,'Budget', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Costs',7,2012,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (5,'Revenue',8,2012,'Forecast Q1', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Costs',7,2012,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (6,'Revenue',8,2012,'Forecast Q2', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Costs',7,2012,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (7,'Revenue',8,2012,'Forecast Q3', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Costs',7,2012,'Rolling ', @pLoadId)
	INSERT [TM1Control].[PlanningCalendar] ( [PlanningScenarioKey], [PlanningFileType], [PlanningFileTypeKey], [PlanningYear], [PlanningScenario], InsertLoadId) VALUES (8,'Revenue',8,2012,'Rolling', @pLoadId)

--check Keys
  UPDATE pc
  SET pc.[PlanningScenarioKey] = ps.[PlanningScenarioUniqueKey]
  FROM [TM1Control].[PlanningCalendar] pc
  JOIN [TM1Control].[PlanningScenario] ps on pc.[PlanningScenario] = ps.PlanningScenario

  UPDATE pc
  SET pc.PlanningFileTypeKey = pt.[PlanningFileTypeUniqueKey]
  FROM [TM1Control].[PlanningCalendar] pc
  JOIN [TM1Control].[ImportFileType] pt on pc.PlanningFileType = pt.[PlanningFileTypeName]

END
GO
PRINT N'Creating [TM1Control].[PotentialFilesForDeletion]...';


GO

--------------------------------------------------------------------------
--Created By : Tim Firmin 2018APR16 ~ TM1 Extact H2 Project
--Files For Deletion TM1
--Last Change : Tim Firmin 2018APR16 - 
--Test001 : EXEC [TM1control].[PotentialFilesForDeletion] @pFilePath = '\\ONP-MS-FSS-DV01\Data\Proj\Hector2\Dev\'
--Test002 :
--------------------------------------------------------------------------

CREATE PROCEDURE [TM1Control].[PotentialFilesForDeletion]
  @pFilePath varchar(150) --   '[SourceFileName] = 'DistributionFilePRS_Extract_30062017'
AS
BEGIN

--DECLARE @PathLocn as varchar(50)
--SET @PathLocn  = '\\ONP-MS-FSS-DV01\Data\Proj\Hector2\Dev\'
 
SELECT  
ifl.FileLogUniqueKey as FileLogKey
,
case when ExtractValidStatus = 'Y'
then
replace(ifl.FilePath, @pFilePath
+ ift.PlanningFileTypeImportFolderName,   @pFilePath
+ ift.PlanningFileTypeProcessedFolderName)
else
replace(ifl.FilePath, @pFilePath
+ ift.PlanningFileTypeImportFolderName,   @pFilePath + ift.PlanningFileTypeArchiveFolderName)
end as ArchivePath
,ift.PlanningFileRetentionDays
,dateadd(day,ift.PlanningFileRetentionDays,CONVERT(DATETIME, ifl.FileCreatedTimeStamp, 103)) as DeleteDateAge
,datediff(day,getdate(),dateadd(day,ift.PlanningFileRetentionDays,CONVERT(DATETIME, ifl.FileCreatedTimeStamp, 103)) ) as DaysUntilDelete
,case when datediff(day,getdate(),dateadd(day,ift.PlanningFileRetentionDays,CONVERT(DATETIME, ifl.FileCreatedTimeStamp, 103)) ) < 1 then 'Y' else 'N' end as DeleteFileFlag
	
 FROM [TM1Control].[ImportFileLog] ifl
 join [TM1Control].[ImportFileType] ift
 on ifl.FileTypeKey = ift.PlanningFileTypeUniqueKey
 WHERE [LoadId] in (select distinct [LoadId]   FROM [TM1Control].[ImportFileLog]   where [ExtractValidStatus] = 'Y')

 END
GO

CREATE VIEW [TM1Transform].[DistributionRevenueOutput]
AS

SELECT 
	 pd.[Company] AS [CompanyCode]
	,pd.[EL1Code] as AccountCodeEL1
	,pd.EL1Description as AccountDescrEL1
	,pd.[EL2Code] as AccountCodeEL2
	,pd.EL2Description as AccountDescrEL2
	,pd.[PlanningScenario]
	,pd.[PlanningPeriod]
	,pd.[PlanningYear]
	,pd.[PlanningFilePeriodSeq]
	,pd.[PlanningPeriodFirstDay]
	,[Level4] as TM1CategoryOnlineBroadcast
	,[Level1] as TM1BroadcastGroup
	,sum(pd.[ValueGBP]) as [ValueGBP]
	,[PlanningFileLogKey] as TM1PlanningFileLogKey
	,pd.[InsertLoadId]


  FROM [TM1Transform].[PlanningData] pd
  JOIN [TM1Control].[PlanningScenario] ps on pd.PlanningScenarioKey = ps.PlanningScenarioUniqueKey

  WHERE ps.PlanningScenarioValidFPV = 'Y'
  and pd.[EL2Code] like 'C%'
  and pd.[Class] = 'Revenue'

 GROUP  BY 
	 pd.[Company]
	,pd.[EL1Code]
	,pd.EL1Description 
	,pd.[EL2Code]
	,pd.EL2Description 
	,pd.PlanningScenario
	,pd.[PlanningPeriod]
	,pd.[PlanningYear]
	,pd.[PlanningFilePeriodSeq]
	,pd.[PlanningPeriodFirstDay] 
	,pd.[Level4] 
	,pd.[Level1]
	,pd.[PlanningFileLogKey] 
	,pd.[InsertLoadId]

GO

CREATE VIEW [TM1Transform].[FinancialAnalyticsOutput]
AS

SELECT 
		CAST(HashBytes('SHA1', pd.[Company])	AS bigint) AS [CompanyKey]
		,CAST(HashBytes('SHA1', pd.[Company] + '_TM1')	AS bigint) AS [DocumentKey]
		  ,isnull(replace(ift.PlanningFileTypeName,'Data',''), 'Unknown') as TM1CostRevenue
      ,min([Class]) as TM1Class
      ,min([Level4]) as TM1Level4
      ,min([Level3]) as TM1Level3
      ,min([Level2]) as TM1Level2
      ,min([Level1]) as TM1Level1
      ,cast(pd.[Company] + '_' + pd.[EL1Code] as varchar(50)) as AccountCode_EL1
	  ,isnull(el1.AccountEL1_KEY, CAST(HashBytes('SHA1', pd.[Company] + '_ ') AS bigint)) as AccountKey_EL1
      ,cast(pd.[Company] + '_' + pd.[EL2Code] as varchar(50)) as AccountCode_EL2
	  ,isnull(el2.AccountEL2_KEY, CAST(HashBytes('SHA1', pd.[Company] + '_ ') AS bigint)) as AccountKey_EL2
      ,pd.[PlanningPeriod]
      ,pd.[PlanningYear]
	  ,pd.[PlanningPeriodFirstDay] as CodaFiscalDate
      ,pd.[PlanningFilePeriodSeq]

	,sum(case when pd.[PlanningScenario] = 'Budget' then pd.[ValueGBP] else 0 end) as BudgetValue
	,sum(case when pd.[PlanningScenario] = 'Forecast Q1' then pd.[ValueGBP] else 0 end) as ForecastQ1Value
	,sum(case when pd.[PlanningScenario] = 'Forecast Q2' then pd.[ValueGBP] else 0 end) as ForecastQ2Value
	,sum(case when pd.[PlanningScenario] = 'Forecast Q3' then pd.[ValueGBP] else 0 end) as ForecastQ3Value
	,sum(case when pd.[PlanningScenario] in ('Budget','Forecast Q1','Forecast Q2','Forecast Q3') then pd.[ValueGBP] else 0 end) as FullSendValue
      ,[PlanningFileLogKey] as SourcePlanningFileLogKey
      ,pd.[InsertLoadId]
  FROM [TM1Transform].[PlanningData] pd
  JOIN [TM1Control].[PlanningScenario] ps on pd.PlanningScenarioKey = ps.PlanningScenarioUniqueKey
  LEFT JOIN [CodaTransform].[Dim_Accounts_EL1] el1 ON cast(pd.[Company] + '_' + pd.[EL1Code] as varchar(50)) =	el1.AccountKey_EL1
  LEFT JOIN [CodaTransform].[Dim_Accounts_EL2] el2 ON cast(pd.[Company] + '_' + pd.[EL2Code] as varchar(50)) =	el2.AccountKey_EL2
  LEFT JOIN [TM1Control].[ImportFileType] ift on pd.PlanningFileTypeKey = ift.PlanningFileTypeUniqueKey
  WHERE ps.PlanningScenarioValidFDM = 'Y'
  GROUP  BY 
 pd.[Company]
,pd.[PlanningFilePeriodSeq]
,pd.[EL1Code]
,pd.[EL2Code]
,pd.[PlanningPeriod]
,pd.[PlanningYear]
,pd.[PlanningPeriodFirstDay]
,pd.[PlanningFileLogKey]
,pd.[InsertLoadId]
,el1.AccountEL1_KEY	
,el2.AccountEL2_KEY
,ift.PlanningFileTypeName

having sum(case when pd.[PlanningScenario] in ('Budget','Forecast Q1','Forecast Q2','Forecast Q3') then pd.[ValueGBP] else 0 end) <> 0
GO

